#!/bin/bash

function test_net::using_smart_proxy() {
  config::set PROXY_IP httpbin.zcorky.com
  config::set PROXY_PORT 80

  local ORIGIN_PROXY_IP=$PROXY_IP
  local ORIGIN_PROXY_PORT=$PROXY_PORT

  testing::expect \
    "${FUNCNAME[0]}" \
    "to_equal" \
    "" \
    "$HTTPS_PROXY"

  net::using_smart_proxy

  testing::expect \
    "${FUNCNAME[0]}" \
    "to_equal" \
    "http://httpbin.zcorky.com:80" \
    "$HTTPS_PROXY"

  config::remove $PROXY_IP
  config::remove $PROXY_PORT

  export PROXY_IP=$ORIGIN_PROXY_IP
  export PROXY_PORT=$ORIGIN_PROXY_PORT
  export https_proxy=http://$PROXY_IP:$PROXY_PORT http_proxy=http://$PROXY_IP:$PROXY_PORT all_proxy=socks5://$PROXY_IP:$PROXY_PORT
  export HTTPS_PROXY=http://$PROXY_IP:$PROXY_PORT HTTP_PROXY=http://$PROXY_IP:$PROXY_PORT ALL_PROXY=socks5://$PROXY_IP:$PROXY_PORT
}
